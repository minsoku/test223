<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quest ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì •</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background: #1a1a2e;
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 30px;
      }
      h1 {
        text-align: center;
        color: #4ecdc4;
      }
      .status {
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }
      .success {
        background: #4caf50;
      }
      .error {
        background: #f44336;
      }
      .warning {
        background: #ff9800;
      }
      .info {
        background: #2196f3;
      }
      button {
        background: #4ecdc4;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        cursor: pointer;
        margin: 10px 5px;
        font-size: 16px;
        width: 100%;
      }
      button:hover {
        background: #45b7b8;
      }
      #log {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        padding: 15px;
        font-family: monospace;
        font-size: 14px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 20px;
      }
      .controller-display {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 20px 0;
      }
      .controller {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #666;
      }
      .controller.active {
        border-color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”§ Quest ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì •</h1>

      <div class="status info">
        <strong>ë¬¸ì œ:</strong> Quest ê¸°ë³¸ í™”ë©´ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ë™í•˜ì§€ë§Œ
        ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì…ë ¥ì´ 0ìœ¼ë¡œ ë‚˜ì˜´
      </div>

      <button onclick="fixMethod1()">ğŸ”§ ë°©ë²• 1: Quest ì„¤ì • ê°€ì´ë“œ</button>
      <button onclick="fixMethod2()">ğŸ”§ ë°©ë²• 2: ë¸Œë¼ìš°ì € ê¶Œí•œ ìˆ˜ì •</button>
      <button onclick="fixMethod3()">ğŸ”§ ë°©ë²• 3: ê°•í™”ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì§€</button>
      <button onclick="testFixed()">âœ… ìˆ˜ì • í…ŒìŠ¤íŠ¸</button>

      <div class="controller-display">
        <div id="left-controller" class="controller">
          <h3>ğŸ‘ˆ ì™¼ìª½</h3>
          <div id="left-status">ëŒ€ê¸° ì¤‘</div>
        </div>
        <div id="right-controller" class="controller">
          <h3>ğŸ‘‰ ì˜¤ë¥¸ìª½</h3>
          <div id="right-status">ëŒ€ê¸° ì¤‘</div>
        </div>
      </div>

      <div id="log"></div>
    </div>

    <script>
      function log(message) {
        const logElement = document.getElementById("log");
        const timestamp = new Date().toLocaleTimeString();
        logElement.innerHTML += `[${timestamp}] ${message}<br>`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function fixMethod1() {
        log("ğŸ”§ ë°©ë²• 1: Quest ì„¤ì • ê°€ì´ë“œ");
        log("");
        log("ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼í•´ì£¼ì„¸ìš”:");
        log("1. Questì—ì„œ ì„¤ì • â†’ ì‹œìŠ¤í…œ â†’ ê°œë°œì");
        log('2. "USB ì—°ê²° ëŒ€í™”ìƒì" í™œì„±í™”');
        log("3. ì„¤ì • â†’ ê°œì¸ì •ë³´ ë³´í˜¸");
        log('4. "ì•±ì´ ì† ì¶”ì  ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ë„ë¡ í—ˆìš©" ì²´í¬');
        log("5. Quest ì¬ì‹œì‘");
        log("");
        log('ì™„ë£Œ í›„ "ìˆ˜ì • í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”');
      }

      function fixMethod2() {
        log("ğŸ”§ ë°©ë²• 2: ë¸Œë¼ìš°ì € ê¶Œí•œ ìˆ˜ì •");
        log("");
        log("Quest ë¸Œë¼ìš°ì €ì—ì„œ:");
        log("1. ìƒˆ íƒ­ì—ì„œ chrome://settings/content/sensors ì…ë ¥");
        log('2. "ì‚¬ì´íŠ¸ì—ì„œ ëª¨ì…˜ ì„¼ì„œì— ì•¡ì„¸ìŠ¤í•˜ë„ë¡ í—ˆìš©" í™œì„±í™”');
        log("3. ì´ í˜ì´ì§€ë¡œ ëŒì•„ì™€ì„œ ìƒˆë¡œê³ ì¹¨");
        log("");
        log("ë˜ëŠ”:");
        log("1. ì£¼ì†Œí‘œì‹œì¤„ ì™¼ìª½ ìë¬¼ì‡  ì•„ì´ì½˜ í´ë¦­");
        log('2. "ëª¨ì…˜ ë° ê´‘ì„¼ì„œ" í—ˆìš©ìœ¼ë¡œ ì„¤ì •');
        log("");
        log('ì™„ë£Œ í›„ "ìˆ˜ì • í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”');
      }

      async function fixMethod3() {
        log("ğŸ”§ ë°©ë²• 3: ê°•í™”ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì§€ ì‹œì‘...");

        try {
          // ê¶Œí•œ ìš”ì²­
          if ("permissions" in navigator) {
            try {
              await navigator.permissions.query({
                name: "xr-spatial-tracking",
              });
              log("âœ… XR ê¶Œí•œ í™•ì¸ë¨");
            } catch (e) {
              log("âš ï¸ XR ê¶Œí•œ í™•ì¸ ë¶ˆê°€");
            }
          }

          // ê°•í™”ëœ VR ì„¸ì…˜ ìƒì„±
          log("VR ì„¸ì…˜ ìƒì„± ì¤‘...");
          const session = await navigator.xr.requestSession("immersive-vr", {
            optionalFeatures: ["local-floor", "bounded-floor", "hand-tracking"],
          });

          log("âœ… VR ì„¸ì…˜ ìƒì„± ì„±ê³µ");

          // ì§€ì—°ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì§€
          setTimeout(() => {
            checkControllersEnhanced(session);
          }, 2000);

          // ì…ë ¥ ì†ŒìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
          session.addEventListener("inputsourceschange", () => {
            log("ğŸ“¡ ì…ë ¥ ì†ŒìŠ¤ ë³€ê²½ë¨");
            checkControllersEnhanced(session);
          });
        } catch (error) {
          log(`âŒ ë°©ë²• 3 ì‹¤íŒ¨: ${error.message}`);
        }
      }

      function checkControllersEnhanced(session) {
        const inputSources = session.inputSources;
        log(`ğŸ” ì…ë ¥ ì†ŒìŠ¤: ${inputSources.length}ê°œ`);

        // UI ì´ˆê¸°í™”
        document.getElementById("left-controller").className = "controller";
        document.getElementById("right-controller").className = "controller";
        document.getElementById("left-status").textContent = "ì—°ê²° ì•ˆë¨";
        document.getElementById("right-status").textContent = "ì—°ê²° ì•ˆë¨";

        inputSources.forEach((source, index) => {
          const hand = source.handedness;
          log(`ì…ë ¥ ${index}: ${hand} ì†, ê²Œì„íŒ¨ë“œ: ${!!source.gamepad}`);

          if (hand === "left" || hand === "right") {
            document.getElementById(`${hand}-controller`).className =
              "controller active";
            document.getElementById(`${hand}-status`).textContent = "âœ… ì—°ê²°ë¨";

            if (source.gamepad) {
              monitorGamepad(source.gamepad, hand);
            }
          }
        });
      }

      function monitorGamepad(gamepad, hand) {
        log(`ğŸ® ${hand} ì»¨íŠ¸ë¡¤ëŸ¬ ê²Œì„íŒ¨ë“œ ëª¨ë‹ˆí„°ë§ ì‹œì‘`);

        const checkInputs = () => {
          gamepad.buttons.forEach((button, index) => {
            if (button.pressed && button.value > 0) {
              log(`ğŸ¯ ${hand} ë²„íŠ¼ ${index}: ${button.value.toFixed(3)}`);
            }
          });

          if (gamepad.axes.length >= 2) {
            const x = gamepad.axes[0];
            const y = gamepad.axes[1];
            if (Math.abs(x) > 0.1 || Math.abs(y) > 0.1) {
              log(`ğŸ•¹ï¸ ${hand} ìŠ¤í‹±: X=${x.toFixed(2)}, Y=${y.toFixed(2)}`);
            }
          }

          requestAnimationFrame(checkInputs);
        };

        checkInputs();
      }

      async function testFixed() {
        log("âœ… ìˆ˜ì • í…ŒìŠ¤íŠ¸ ì‹œì‘...");

        try {
          if (!navigator.xr) {
            throw new Error("WebXR ë¯¸ì§€ì›");
          }

          const session = await navigator.xr.requestSession("immersive-vr");
          log("âœ… VR ì„¸ì…˜ ìƒì„± ì„±ê³µ");

          // 2ì´ˆ í›„ ì»¨íŠ¸ë¡¤ëŸ¬ í™•ì¸
          setTimeout(() => {
            const inputSources = session.inputSources;
            log(`ğŸ” ì»¨íŠ¸ë¡¤ëŸ¬ ê°œìˆ˜: ${inputSources.length}`);

            if (inputSources.length > 0) {
              log("ğŸ‰ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì§€ë¨! ì´ì œ ê²Œì„ì„ ì‹œë„í•´ë³´ì„¸ìš”!");

              inputSources.forEach((source) => {
                if (source.gamepad) {
                  log(`âœ… ${source.handedness} ì»¨íŠ¸ë¡¤ëŸ¬ ê²Œì„íŒ¨ë“œ ì‚¬ìš© ê°€ëŠ¥`);
                }
              });
            } else {
              log("âŒ ì•„ì§ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
              log("ğŸ’¡ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í”ë“¤ê±°ë‚˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”");
            }
          }, 2000);
        } catch (error) {
          log(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
        }
      }

      window.onload = function () {
        log("ğŸ”§ Quest ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì • ë„êµ¬ ì‹œì‘");
        log("ğŸ’¡ ìœ„ì˜ ë°©ë²•ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì‹œë„í•´ë³´ì„¸ìš”");
      };
    </script>
  </body>
</html>
