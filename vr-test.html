<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VR ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f0f0f0;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 10px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      #log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ•¹ï¸ VR ì—°ê²° í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>

    <div class="test-section">
      <h2>1. ê¸°ë³¸ í™˜ê²½ í™•ì¸</h2>
      <div id="basic-checks"></div>
    </div>

    <div class="test-section">
      <h2>2. WebXR ì§€ì› í™•ì¸</h2>
      <div id="webxr-checks"></div>
      <button onclick="checkWebXR()">WebXR ë‹¤ì‹œ í™•ì¸</button>
    </div>

    <div class="test-section">
      <h2>3. VR í—¤ë“œì…‹ ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
      <div id="vr-device-checks"></div>
      <button onclick="testVRConnection()">VR ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    </div>

    <div class="test-section">
      <h2>4. ìƒì„¸ ë¡œê·¸</h2>
      <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
      <div id="log"></div>
    </div>

    <script>
      let logElement = document.getElementById("log");

      function log(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const logMessage = `[${timestamp}] ${message}\n`;
        logElement.textContent += logMessage;
        logElement.scrollTop = logElement.scrollHeight;
        console.log(message);
      }

      function clearLog() {
        logElement.textContent = "";
      }

      function showStatus(elementId, message, type) {
        const element = document.getElementById(elementId);
        const statusDiv = document.createElement("div");
        statusDiv.className = `status ${type}`;
        statusDiv.textContent = message;
        element.appendChild(statusDiv);
      }

      // ê¸°ë³¸ í™˜ê²½ í™•ì¸
      function checkBasicEnvironment() {
        const checks = document.getElementById("basic-checks");
        checks.innerHTML = "";

        // HTTPS í™•ì¸
        const isHTTPS =
          window.location.protocol === "https:" ||
          window.location.hostname === "localhost";
        showStatus(
          "basic-checks",
          `í”„ë¡œí† ì½œ: ${window.location.protocol} ${
            isHTTPS ? "âœ…" : "âŒ (HTTPS í•„ìš”)"
          }`,
          isHTTPS ? "success" : "error"
        );

        // ë¸Œë¼ìš°ì € í™•ì¸
        const userAgent = navigator.userAgent;
        let browserName = "Unknown";
        if (userAgent.includes("Chrome") && !userAgent.includes("Edg"))
          browserName = "Chrome";
        else if (userAgent.includes("Edg")) browserName = "Edge";
        else if (userAgent.includes("Firefox")) browserName = "Firefox";

        const supportedBrowser = ["Chrome", "Edge"].includes(browserName);
        showStatus(
          "basic-checks",
          `ë¸Œë¼ìš°ì €: ${browserName} ${
            supportedBrowser ? "âœ…" : "âš ï¸ (Chrome/Edge ê¶Œì¥)"
          }`,
          supportedBrowser ? "success" : "warning"
        );

        log(
          `ê¸°ë³¸ í™˜ê²½ í™•ì¸ ì™„ë£Œ - HTTPS: ${isHTTPS}, ë¸Œë¼ìš°ì €: ${browserName}`
        );
      }

      // WebXR ì§€ì› í™•ì¸
      async function checkWebXR() {
        const checks = document.getElementById("webxr-checks");
        checks.innerHTML = "";

        log("WebXR ì§€ì› ìƒíƒœ í™•ì¸ ì‹œì‘...");

        // navigator.xr í™•ì¸
        if (!navigator.xr) {
          showStatus("webxr-checks", "âŒ navigator.xrì´ ì—†ìŠµë‹ˆë‹¤", "error");
          log("âŒ navigator.xr APIê°€ ì‚¬ìš© ë¶ˆê°€ëŠ¥");
          return false;
        }

        showStatus("webxr-checks", "âœ… navigator.xr ì‚¬ìš© ê°€ëŠ¥", "success");
        log("âœ… navigator.xr API ì‚¬ìš© ê°€ëŠ¥");

        try {
          // VR ì„¸ì…˜ ì§€ì› í™•ì¸
          const isSupported = await navigator.xr.isSessionSupported(
            "immersive-vr"
          );
          if (isSupported) {
            showStatus("webxr-checks", "âœ… VR ì„¸ì…˜ ì§€ì›ë¨", "success");
            log("âœ… immersive-vr ì„¸ì…˜ ì§€ì›ë¨");
            return true;
          } else {
            showStatus("webxr-checks", "âŒ VR ì„¸ì…˜ ë¯¸ì§€ì›", "error");
            log("âŒ immersive-vr ì„¸ì…˜ ë¯¸ì§€ì›");
            return false;
          }
        } catch (error) {
          showStatus(
            "webxr-checks",
            `âŒ WebXR í™•ì¸ ì˜¤ë¥˜: ${error.message}`,
            "error"
          );
          log(`âŒ WebXR í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message}`);
          return false;
        }
      }

      // VR ì—°ê²° í…ŒìŠ¤íŠ¸
      async function testVRConnection() {
        const checks = document.getElementById("vr-device-checks");
        checks.innerHTML = "";

        log("VR í—¤ë“œì…‹ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...");

        if (!navigator.xr) {
          showStatus("vr-device-checks", "âŒ WebXR ë¯¸ì§€ì›", "error");
          return;
        }

        try {
          log("ğŸ”„ VR ì„¸ì…˜ ìš”ì²­ ì‹œë„...");
          showStatus(
            "vr-device-checks",
            "ğŸ”„ VR í—¤ë“œì…‹ ì—°ê²° ì‹œë„ ì¤‘...",
            "info"
          );

          // ì‹¤ì œ VR ì„¸ì…˜ ìš”ì²­
          const session = await navigator.xr.requestSession("immersive-vr");

          log("âœ… VR ì„¸ì…˜ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë¨!");
          showStatus("vr-device-checks", "âœ… VR í—¤ë“œì…‹ ì—°ê²° ì„±ê³µ!", "success");

          // ì„¸ì…˜ ì •ë³´ í‘œì‹œ
          log(`ì„¸ì…˜ ì •ë³´ - inputSources: ${session.inputSources.length}ê°œ`);

          // ì„¸ì…˜ ì¢…ë£Œ
          await session.end();
          log("VR ì„¸ì…˜ ì¢…ë£Œë¨");
          showStatus(
            "vr-device-checks",
            "âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - VR í—¤ë“œì…‹ì´ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤!",
            "success"
          );
        } catch (error) {
          log(`âŒ VR ì—°ê²° ì‹¤íŒ¨: ${error.name} - ${error.message}`);

          let errorMessage = "VR ì—°ê²° ì‹¤íŒ¨: ";
          let suggestion = "";

          if (error.name === "NotSupportedError") {
            errorMessage += "VR í—¤ë“œì…‹ì´ ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤";
            suggestion =
              "ğŸ’¡ í•´ê²°ì±…: Meta Questë¥¼ ì¼œê³  USB/ë¬´ì„ ìœ¼ë¡œ PCì™€ ì—°ê²°í•˜ì„¸ìš”";
          } else if (error.name === "NotAllowedError") {
            errorMessage += "VR ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤";
            suggestion = "ğŸ’¡ í•´ê²°ì±…: ë¸Œë¼ìš°ì €ì—ì„œ VR ê¶Œí•œì„ í—ˆìš©í•˜ì„¸ìš”";
          } else if (error.name === "SecurityError") {
            errorMessage += "ë³´ì•ˆ ì˜¤ë¥˜";
            suggestion = "ğŸ’¡ í•´ê²°ì±…: HTTPS ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”";
          } else {
            errorMessage += error.message;
            suggestion =
              "ğŸ’¡ í•´ê²°ì±…: í—¤ë“œì…‹ì„ ë‹¤ì‹œ ì—°ê²°í•˜ê³  ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”";
          }

          showStatus("vr-device-checks", `âŒ ${errorMessage}`, "error");
          if (suggestion) {
            showStatus("vr-device-checks", suggestion, "warning");
          }
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
      window.onload = function () {
        checkBasicEnvironment();
        setTimeout(checkWebXR, 500);
      };
    </script>
  </body>
</html>
